---
id: arch-compile
title: ä»æºç ç¼–è¯‘é•œåƒ
---

## ğŸ“¦ å‰ææ¡ä»¶

- ä¸€å°è¿è¡Œ Arch Linuxã€Arch Linux ARM æˆ–å…¶ä»–åŸºäº Arch çš„å‘è¡Œç‰ˆçš„è®¡ç®—æœº
- root æƒé™
- 15GB çš„ç©ºé—²ç©ºé—´
- 8GB çš„å†…å­˜
- ä¸€äº›è€å¿ƒ

## ğŸš€ ç®€ä»‹

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†å¸¦ä½ äº†è§£å¦‚ä½•ä¸º Fydetab Duo ä»æºä»£ç åˆ¶ä½œé•œåƒã€‚è¿™å°†å…è®¸ä½ åˆ›å»ºå…·æœ‰ç‰¹å®šé…ç½®å’Œè½¯ä»¶åŒ…çš„è‡ªå®šä¹‰é•œåƒã€‚è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºä½¿ç”¨ mkarchiso å·¥å…·åˆ›å»º Arch Linux ISO é•œåƒï¼Œä½†ç»è¿‡ä¸€äº›ä¿®æ”¹ï¼Œä»¥æ”¯æŒ ARM64 æ¶æ„å’Œ Fydetab Duo ç¡¬ä»¶ã€‚

- åç«¯åº“ï¼š[ImageForge](https://github.com/Linux-for-Fydetab-Duo/imageforge)
- é•œåƒä»“åº“ï¼š[GitHub](https://github.com/Linux-for-Fydetab-Duo/images)

### é•œåƒç»“æ„

ä»¥ä¸‹æ˜¯ Fydetab Duo é•œåƒä¸­å„ä¸ªæ–‡ä»¶çš„è¯´æ˜ï¼š

- `fydetab-duo_UEFI.img`ï¼šè¿™æ˜¯ Fydetab Duo çš„ UEFI é•œåƒæ–‡ä»¶ï¼ŒåŒ…å«å¯åŠ¨åŠ è½½å™¨ã€‚

- `packages.aarch64`ï¼šè¯¥æ–‡ä»¶åˆ—å‡ºäº†å°†åœ¨ Fydetab Duo ä¸Šå®‰è£…çš„æ‰€æœ‰è½¯ä»¶åŒ…ã€‚å®ƒåœ¨é•œåƒåˆ›å»ºè¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œä»¥æŒ‡å®šæ‰€éœ€çš„è½¯ä»¶åŒ…ã€‚

- `pacman.conf.aarch64`ï¼šè¿™æ˜¯ç‰¹å®šäº ARM64 æ¶æ„çš„ Pacman é…ç½®æ–‡ä»¶ï¼ŒåŒ…ç®¡ç†å™¨å°†ä½¿ç”¨æ­¤æ–‡ä»¶æ¥ç¡®å®šè½¯ä»¶åŒ…æºå’Œé…ç½®ã€‚

- `profiledef`ï¼šæ­¤æ–‡ä»¶å®šä¹‰äº† Fydetab Duo é•œåƒçš„é…ç½®æ–‡ä»¶ã€‚å®ƒæŒ‡å®šäº†ç³»ç»Ÿé…ç½®ï¼Œå¦‚ç£ç›˜åˆ†åŒºã€è¾“å‡ºé•œåƒåç§°ä»¥åŠå…¶ä»–è®¾ç½®ã€‚

- `rootfs`ï¼šæ­¤ç›®å½•åŒ…å« Fydetab Duo é•œåƒçš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ„æˆæ“ä½œç³»ç»Ÿçš„æ‰€æœ‰å¿…è¦æ–‡ä»¶å’Œç›®å½•ã€‚

æ¯ä¸ªæ–‡ä»¶åœ¨é•œåƒåˆ›å»ºè¿‡ç¨‹ä¸­éƒ½èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œå…è®¸ä½ æ ¹æ®å…·ä½“éœ€æ±‚å®šåˆ¶å’Œé…ç½® Fydetab Duo é•œåƒã€‚

## è®¾ç½®æ„å»ºç¯å¢ƒ

### 1. å®‰è£…ä¾èµ–

åœ¨å¼€å§‹æ„å»ºé•œåƒä¹‹å‰ï¼Œä½ éœ€è¦å®‰è£…å¿…è¦çš„ä¾èµ–ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š
```bash
sudo pacman -Sy --noconfirm --needed python parted btrfs-progs git wget arch-install-scripts gptfdisk dosfstools multipath-tools
```
```bash
wget https://deb-mirror.fydeos.com/pacman/repo/fyde/aarch64/python-imageforge-0.0.1-1-any.pkg.tar.zst
sudo pacman -U --noconfirm python-imageforge-0.0.1-1-any.pkg.tar.zst
```

### 2. è®¾ç½® QEMUï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ å¸Œæœ›åœ¨ x86 æœºå™¨ä¸Šæ„å»ºé•œåƒï¼Œå¯ä»¥ä½¿ç”¨ QEMU æ¥æ¨¡æ‹Ÿ ARM64 ç¯å¢ƒã€‚å®‰è£… QEMUï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
sudo pacman -S --noconfirm qemu-user-static qemu-user-static-binfmt
```
é‡å¯ binfmt æœåŠ¡ä»¥å¯ç”¨ QEMUï¼š
```bash
sudo systemctl restart systemd-binfmt
```

### 3. å…‹éš†ä»“åº“

æ¥ä¸‹æ¥ï¼Œå…‹éš† ImageForge ä»“åº“åˆ°æœ¬åœ°è®¡ç®—æœºï¼š
```bash
git clone https://github.com/Linux-for-Fydetab-Duo/images.git
```

### 4. æ„å»ºé•œåƒ

è¿›å…¥ `images` ç›®å½•ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ„å»ºé•œåƒï¼š
```bash
sudo ./fydetab-arch/profiledef -c fydetab-arch -w ./work -o ./out
```

:::note
å¦‚æœä½ æœ‰è¶…è¿‡ 16GB çš„å†…å­˜ï¼Œå¯ä»¥é€šè¿‡å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º tmpfs æŒ‚è½½ç‚¹æ¥åŠ é€Ÿæ„å»ºè¿‡ç¨‹ã€‚è¿™æ ·å¯ä»¥å‡å°‘ I/O å¼€é”€ï¼Œå¹¶åŠ å¿«é•œåƒåˆ›å»ºé€Ÿåº¦ã€‚åœ¨è¿è¡Œ profiledef å‘½ä»¤æ—¶ï¼ŒæŒ‡å®š `-w /tmp/work` ä½œä¸ºå·¥ä½œç›®å½•ã€‚
:::

### 5. åˆ·å†™é•œåƒ

é•œåƒåˆ›å»ºå®Œæˆåï¼Œä½ å¯ä»¥æŒ‰ç…§ [å®‰è£…](https://wiki.fydetabduo.com/os-release-board/Arch%20Linux/arch-install) æŒ‡å—ä¸­çš„è¯´æ˜ï¼Œå°†ç”Ÿæˆçš„é•œåƒåˆ·å†™åˆ° microSD å¡æˆ– eMMC ä¸­ã€‚

## å¸¸è§é—®é¢˜

1. ä¸‹è½½åº“é”™è¯¯ï¼š
   > æœ‰æ—¶ï¼Œç”±äºç½‘ç»œè¿æ¥ä¸ç¨³å®šï¼Œæ„å»ºè¿‡ç¨‹å¯èƒ½ä¼šç”±äºä¸‹è½½åº“é”™è¯¯è€Œå¤±è´¥ã€‚é”™è¯¯ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š
   ```bash
   warning: failed to retrieve some files
   error: failed to commit transaction (download library error)
   Errors occurred, no packages were upgraded.
   ==> ERROR: Failed to install packages to new root
   Traceback (most recent call last):
     File "/home/panda/images/fydetab-arch/profiledef", line 82, in <module>
       main()
     File "/home/panda/images/fydetab-arch/profiledef", line 58, in main
       pacstrap_packages()
     File "/usr/lib/python3.12/site-packages/imageforge/packages.py", line 23, in pacstrap_packages
       subprocess.run(
     File "/usr/lib/python3.12/subprocess.py", line 571, in run
       raise CalledProcessError(retcode, process.args,
   subprocess.CalledProcessError: Command '['pacstrap -c -C /home/panda/images/fydetab-arch/pacman.conf.aarch64 -M -G /home/panda/images/work/aarch64  ..... ']' returned non-zero exit status 1.
   ```
   - ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥å°è¯•é‡æ–°è¿è¡Œ profiledef å‘½ä»¤ã€‚å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œå¯ä»¥åœ¨ ImageForge ä»“åº“ä¸­æäº¤é—®é¢˜ï¼Œä»¥ä¾¿è·å–è¿›ä¸€æ­¥çš„å¸®åŠ©ã€‚