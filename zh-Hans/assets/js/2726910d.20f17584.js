"use strict";(self.webpackChunkfydetab_wiki=self.webpackChunkfydetab_wiki||[]).push([[944],{5008:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var s=n(4848),t=n(8453);const r={id:"arch-compile",title:"Making images from source"},o=void 0,a={id:"os-release-board/Arch Linux/arch-compile",title:"Making images from source",description:"\ud83d\udce6 Prerequisites",source:"@site/docs/os-release-board/Arch Linux/3.Compiling from source.md",sourceDirName:"os-release-board/Arch Linux",slug:"/os-release-board/Arch Linux/arch-compile",permalink:"/zh-Hans/os-release-board/Arch Linux/arch-compile",draft:!1,unlisted:!1,editUrl:"https://github.com/FydeOS/fydetabduo-wiki/tree/main/docs/os-release-board/Arch Linux/3.Compiling from source.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"arch-compile",title:"Making images from source"},sidebar:"tutorialSidebar",previous:{title:"Installation",permalink:"/zh-Hans/os-release-board/Arch Linux/arch-install"},next:{title:"Debian",permalink:"/zh-Hans/os-release-board/debian"}},c={},l=[{value:"\ud83d\udce6 Prerequisites",id:"-prerequisites",level:2},{value:"\ud83d\ude80 Introduction",id:"-introduction",level:2},{value:"Image Structure",id:"image-structure",level:3},{value:"Setting up the build environment",id:"setting-up-the-build-environment",level:2},{value:"1. Install dependencies",id:"1-install-dependencies",level:3},{value:"2. Setting up QEMU (optional)",id:"2-setting-up-qemu-optional",level:3},{value:"3. Clone the repository",id:"3-clone-the-repository",level:3},{value:"4. Build the image",id:"4-build-the-image",level:3},{value:"5. Flash the image",id:"5-flash-the-image",level:3},{value:"Common issues",id:"common-issues",level:2}];function d(e){const i={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.h2,{id:"-prerequisites",children:"\ud83d\udce6 Prerequisites"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"A computer running Arch Linux, Arch Linux ARM or any other Arch-based distribution"}),"\n",(0,s.jsx)(i.li,{children:"Root access"}),"\n",(0,s.jsx)(i.li,{children:"15GB of free space"}),"\n",(0,s.jsx)(i.li,{children:"8GB of RAM"}),"\n",(0,s.jsx)(i.li,{children:"A bit of patience"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"-introduction",children:"\ud83d\ude80 Introduction"}),"\n",(0,s.jsx)(i.p,{children:"In this guide, we will walk you through the process of making images from source for the Fydetab Duo. This will allow you to create custom images with specific configurations and packages. The format is similar to the mkarchiso tool used to create Arch Linux ISO images, but with some modifications to support the ARM64 architecture and the Fydetab Duo hardware."}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["Backend library: ",(0,s.jsx)(i.a,{href:"https://github.com/Linux-for-Fydetab-Duo/imageforge",children:"ImageForge"})]}),"\n",(0,s.jsxs)(i.li,{children:["Images repository: ",(0,s.jsx)(i.a,{href:"https://github.com/Linux-for-Fydetab-Duo/images",children:"GitHub"})]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"image-structure",children:"Image Structure"}),"\n",(0,s.jsx)(i.p,{children:"Here is a breakdown of each file in a Fydetab Duo image:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"fydetab-duo_UEFI.img"}),": This is the UEFI image file for the Fydetab Duo. It contains the boot loader."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"packages.aarch64"}),": This file lists the packages that will be installed on the Fydetab Duo. It is used during the image creation process to specify the desired software packages."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"pacman.conf.aarch64"}),": This is the Pacman configuration file specific to the ARM64 architecture. It is used by the package manager to determine package sources and settings."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"profiledef"}),": This file defines the profile configuration for the Fydetab Duo image. It specifies various system configurations, such as how to partition the disk, output image name, and other settings."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"rootfs"}),": This directory contains the root file system for the Fydetab Duo image. It includes all the necessary files and directories that make up the operating system."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Each of these files plays a crucial role in the image creation process, allowing you to customize and configure the Fydetab Duo image according to your specific needs."}),"\n",(0,s.jsx)(i.h2,{id:"setting-up-the-build-environment",children:"Setting up the build environment"}),"\n",(0,s.jsx)(i.h3,{id:"1-install-dependencies",children:"1. Install dependencies"}),"\n",(0,s.jsx)(i.p,{children:"Before you can start building the image, you need to install the necessary dependencies. Run the following commands to install them:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"sudo pacman -Sy --noconfirm --needed python parted btrfs-progs git wget arch-install-scripts gptfdisk dosfstools multipath-tools\n"})}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"wget https://deb-mirror.fydeos.com/pacman/repo/fyde/aarch64/python-imageforge-0.0.1-1-any.pkg.tar.zst\nsudo pacman -U --noconfirm python-imageforge-0.0.1-1-any.pkg.tar.zst\n"})}),"\n",(0,s.jsx)(i.h3,{id:"2-setting-up-qemu-optional",children:"2. Setting up QEMU (optional)"}),"\n",(0,s.jsx)(i.p,{children:"If you want to build the image on an x86 machine, you can use QEMU to emulate an ARM64 environment. To install QEMU, run the following command:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"sudo pacman -S --noconfirm qemu-user-static qemu-user-static-binfmt\n"})}),"\n",(0,s.jsx)(i.p,{children:"Restart the binfmt service to enable QEMU:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"sudo systemctl restart systemd-binfmt\n"})}),"\n",(0,s.jsx)(i.h3,{id:"3-clone-the-repository",children:"3. Clone the repository"}),"\n",(0,s.jsx)(i.p,{children:"Next, clone the ImageForge repository to your local machine:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"git clone https://github.com/Linux-for-Fydetab-Duo/images.git\n"})}),"\n",(0,s.jsx)(i.h3,{id:"4-build-the-image",children:"4. Build the image"}),"\n",(0,s.jsxs)(i.p,{children:["Navigate to the ",(0,s.jsx)(i.code,{children:"images"})," directory and run the following command to build the image:"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"sudo ./fydetab-arch/profiledef -c fydetab-arch -w ./work -o ./out\n"})}),"\n",(0,s.jsx)(i.admonition,{type:"note",children:(0,s.jsx)(i.p,{children:"If you have more than 16GB of RAM, you can speed up the build process by changing the work directory to a tmpfs mount point. This will reduce the I/O overhead and speed up the image creation process. Specify -w /tmp/work as the work directory when running the profiledef command."})}),"\n",(0,s.jsx)(i.h3,{id:"5-flash-the-image",children:"5. Flash the image"}),"\n",(0,s.jsxs)(i.p,{children:["Once the image creation process is complete, you can flash the resulting image to a microSD card or eMMC by following the instructions in the ",(0,s.jsx)(i.a,{href:"https://wiki.fydetabduo.com/os-release-board/Arch%20Linux/arch-install",children:"Installation"})," guide."]}),"\n",(0,s.jsx)(i.h2,{id:"common-issues",children:"Common issues"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["Download library error:","\n",(0,s.jsxs)(i.blockquote,{children:["\n",(0,s.jsx)(i.p,{children:"Sometimes the build process may fail due to a download library error caused by a poor network connection. The error will look like this:"}),"\n"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:'warning: failed to retrieve some files\nerror: failed to commit transaction (download library error)\nErrors occurred, no packages were upgraded.\n==> ERROR: Failed to install packages to new root\nTraceback (most recent call last):\n  File "/home/panda/images/fydetab-arch/profiledef", line 82, in <module>\n    main()\n  File "/home/panda/images/fydetab-arch/profiledef", line 58, in main\n    pacstrap_packages()\n  File "/usr/lib/python3.12/site-packages/imageforge/packages.py", line 23, in pacstrap_packages\n    subprocess.run(\n  File "/usr/lib/python3.12/subprocess.py", line 571, in run\n    raise CalledProcessError(retcode, process.args,\nsubprocess.CalledProcessError: Command \'[\'pacstrap -c -C /home/panda/images/fydetab-arch/pacman.conf.aarch64 -M -G /home/panda/images/work/aarch64  ..... \']\' returned non-zero exit status 1.\n'})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"To fix the issue, you can try running the profiledef command again. If the issue persists, you can make an issue on the ImageForge repository for further assistance."}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>o,x:()=>a});var s=n(6540);const t={},r=s.createContext(t);function o(e){const i=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(r.Provider,{value:i},e.children)}}}]);